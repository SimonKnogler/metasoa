# Manual Upload to Pavlovia - Step by Step

## Files You Need to Upload

### Required Files (MUST upload)

| File | Location | Size | Purpose |
|------|----------|------|---------|
| `CDT_online.psyexp` | Root | ~50 KB | Main experiment file |
| `conditions.csv` | Root | ~1 KB | Trial conditions |
| `cdt_utils.js` | `js/` folder | ~20 KB | **CRITICAL** - All experiment logic |
| `motion_library.json` | `resources/` folder | ~3.5 MB | Trajectory data |
| `trajectory_pairs.json` | `resources/` folder | ~6 KB | Pre-computed pairs |

### Optional Files (can skip)

| File | Purpose |
|------|---------|
| `cluster_centroids.json` | Not used in current version |
| `scaler_params.json` | Not used in current version |
| `index.html` | Will be auto-generated by Pavlovia |

---

## Step-by-Step Manual Upload

### Step 1: Create Pavlovia Project (5 min)

1. Go to [pavlovia.org](https://pavlovia.org)
2. Log in with your account
3. Click **"New Project"** (or go to Dashboard > New Project)
4. Fill in:
   - **Project name**: `CDT_online`
   - **Visibility**: Private (recommended)
   - **Description**: "Control Detection Task - Online Version"
5. Click **"Create Project"**

### Step 2: Access GitLab Repository (2 min)

Pavlovia uses GitLab for file storage. After creating the project:

1. On your project page, click **"View code"** or the GitLab icon
2. This opens your project's GitLab repository
3. You'll upload files here

### Step 3: Create Folder Structure (3 min)

In GitLab, create the required folders:

1. Click **"+"** button > **"New directory"**
2. Create folder: `js`
3. Click **"+"** button > **"New directory"**  
4. Create folder: `resources`

Your structure should look like:
```
CDT_online/
├── js/
└── resources/
```

### Step 4: Upload Main Files (5 min)

**Upload to ROOT folder:**

1. In GitLab, make sure you're in the root of your project
2. Click **"+"** > **"Upload file"**
3. Upload these files one by one:
   - `CDT_online.psyexp`
   - `conditions.csv`
4. Add commit message: "Add main experiment files"
5. Click **"Upload file"**

### Step 5: Upload JavaScript Utilities (3 min)

**Upload to `js/` folder:**

1. Navigate to the `js/` folder in GitLab
2. Click **"+"** > **"Upload file"**
3. Upload: `cdt_utils.js`
4. Commit message: "Add JavaScript utilities"
5. Click **"Upload file"**

⚠️ **THIS IS THE MOST IMPORTANT FILE** - Contains all the exact replica logic!

### Step 6: Upload Resources (5-10 min)

**Upload to `resources/` folder:**

1. Navigate to the `resources/` folder in GitLab
2. Click **"+"** > **"Upload file"**
3. Upload these files:
   - `motion_library.json` (~3.5 MB - may take a minute)
   - `trajectory_pairs.json`
4. Commit message: "Add motion library and trajectory pairs"
5. Click **"Upload file"**

### Step 7: Generate Experiment Code (5 min)

Now you need to generate the JavaScript version of the experiment:

**Option A: Use PsychoPy Builder (Recommended)**
1. Open `CDT_online.psyexp` in PsychoPy Builder
2. Go to **Experiment > Compile to JS**
3. This creates `CDT_online.js`
4. Upload `CDT_online.js` to the root folder on GitLab

**Option B: Let Pavlovia generate it**
1. On Pavlovia, go to your project
2. Click **"Pilot"** - Pavlovia will attempt to compile
3. If it fails, use Option A

### Step 8: Create/Upload index.html (3 min)

Upload the custom `index.html` that includes `cdt_utils.js`:

1. In GitLab root folder, click **"+"** > **"Upload file"**
2. Upload: `index.html`
3. Commit message: "Add custom index.html with cdt_utils.js"

**OR** create it directly in GitLab:

1. Click **"+"** > **"New file"**
2. Name: `index.html`
3. Paste this content:

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Control Detection Task</title>
    <script type="text/javascript" src="https://lib.pavlovia.org/psychojs-2024.1.1.js"></script>
    <script type="text/javascript" src="js/cdt_utils.js"></script>
</head>
<body>
    <script type="text/javascript" src="CDT_online.js"></script>
</body>
</html>
```

4. Commit message: "Add index.html"
5. Click **"Commit changes"**

### Step 9: Verify File Structure (2 min)

Your GitLab repository should now look like this:

```
CDT_online/
├── CDT_online.psyexp
├── CDT_online.js          (generated or uploaded)
├── conditions.csv
├── index.html
├── js/
│   └── cdt_utils.js       ← CRITICAL FILE
└── resources/
    ├── motion_library.json
    └── trajectory_pairs.json
```

### Step 10: Test the Experiment (5 min)

1. Go back to Pavlovia (not GitLab)
2. Find your project on the Dashboard
3. Set status to **"PILOTING"**
4. Click **"Pilot"**
5. Test the experiment in your browser

---

## Troubleshooting

### "cdt_utils.js not found" or "loadAllResources is not defined"

**Problem**: The JavaScript utilities aren't loading.

**Solution**:
1. Check `index.html` includes: `<script src="js/cdt_utils.js"></script>`
2. Verify `cdt_utils.js` is in the `js/` folder (not root)
3. Check file name is exactly `cdt_utils.js` (case-sensitive)

### "motion_library.json not found"

**Problem**: Resources aren't loading.

**Solution**:
1. Verify file is in `resources/` folder
2. Check file name is exactly `motion_library.json`
3. File might be too large - try uploading via Git command line

### "Experiment won't start"

**Problem**: Missing or incorrect CDT_online.js

**Solution**:
1. Open `CDT_online.psyexp` in PsychoPy Builder
2. Compile to JS: Experiment > Compile to JS
3. Upload the generated `CDT_online.js` to GitLab

### "Shapes don't move correctly"

**Problem**: cdt_utils.js not loaded or wrong version

**Solution**:
1. Open browser console (F12)
2. Look for: "CDT utilities loaded - EXACT REPLICA of offline experiment"
3. If not present, check index.html script order

---

## Alternative: Git Command Line Upload

If GitLab web upload is slow (especially for large files), use Git:

```bash
# Clone your empty Pavlovia project
git clone https://gitlab.pavlovia.org/YOUR_USERNAME/CDT_online.git
cd CDT_online

# Copy all files
cp /path/to/CDT_Online/CDT_online.psyexp .
cp /path/to/CDT_Online/conditions.csv .
cp /path/to/CDT_Online/index.html .
mkdir -p js resources
cp /path/to/CDT_Online/js/cdt_utils.js js/
cp /path/to/CDT_Online/resources/motion_library.json resources/
cp /path/to/CDT_Online/resources/trajectory_pairs.json resources/

# Generate JS (in PsychoPy) and copy
cp /path/to/CDT_Online/CDT_online.js .

# Commit and push
git add .
git commit -m "Add CDT online experiment files"
git push origin main
```

---

## Quick Checklist

Before testing, verify:

- [ ] `CDT_online.psyexp` in root
- [ ] `CDT_online.js` in root (compiled from PsychoPy)
- [ ] `conditions.csv` in root
- [ ] `index.html` in root (with cdt_utils.js script tag)
- [ ] `js/cdt_utils.js` exists
- [ ] `resources/motion_library.json` exists
- [ ] `resources/trajectory_pairs.json` exists
- [ ] Project status set to PILOTING
- [ ] Browser console shows "CDT utilities loaded"

---

## File Locations on Your Computer

All files are in:
```
/Users/simonknogler/Desktop/metasoa/CDT_Online/
```

| File to Upload | Full Path |
|----------------|-----------|
| CDT_online.psyexp | `/Users/simonknogler/Desktop/metasoa/CDT_Online/CDT_online.psyexp` |
| conditions.csv | `/Users/simonknogler/Desktop/metasoa/CDT_Online/conditions.csv` |
| index.html | `/Users/simonknogler/Desktop/metasoa/CDT_Online/index.html` |
| cdt_utils.js | `/Users/simonknogler/Desktop/metasoa/CDT_Online/js/cdt_utils.js` |
| motion_library.json | `/Users/simonknogler/Desktop/metasoa/CDT_Online/resources/motion_library.json` |
| trajectory_pairs.json | `/Users/simonknogler/Desktop/metasoa/CDT_Online/resources/trajectory_pairs.json` |

You can open Finder to this location:
```bash
open /Users/simonknogler/Desktop/metasoa/CDT_Online/
```
